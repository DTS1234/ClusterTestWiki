<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Setup - Cluster Test Wiki</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Setup";
        var mkdocs_page_input_path = "testing-recluster/setup.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Cluster Test Wiki
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Overview</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../overview/introduction/">Introduction</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Cluster Probe</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../cluster-probe/requirements/">Requirements</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cluster-probe/design/">Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cluster-probe/implementation/">Implementation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cluster-probe/user-guide/">User guide</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Probe Builder</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../probe-builder/requirements/">Requirements</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../probe-builder/design/">Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../probe-builder/implementation/">Implementation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../probe-builder/user-guide/">User guide</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Cluster Test Wiki</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>Setup</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h3 id="introduction">Introduction</h3>
<p>In this section you will find a guide on how to run tests on reCluster, with ClusterProbe and ProbeBuilder.</p>
<h3 id="ssh-setup">SSH setup</h3>
<p>In order to access reCluster you need a configured ssh connection with reLaptop.
If you don't have an access, you need to reach Lorenzo Angeli, the project owner.
Also remember to configure the VPN connection with the university network (https://icts.unitn.it/en/vpn).</p>
<p>Having an ssh connection configured you should be able to connect to the reLaptop:</p>
<p><code>ssh user@10.196.37.164</code> where <code>user</code> would be your username.</p>
<p>now you can ssh to reCluster:</p>
<p><code>ssh recluster</code></p>
<h3 id="scripts">Scripts</h3>
<p>Once you will be logged in into the reCluster you will be able to find a set of scripts in the root directory:</p>
<ul>
<li>pod.sh - this script will keep track of the amount of pods for a specified amount of time, the results will be saved in files node_name_pod_counts.csv. You
  need to specify the amount of seconds for which this script will be running, it should be equal to the duration of the test.</li>
<li>hpa.sh - this script will set a specified target for horizontal pod autoscaling, if no arguments will be passed the default value is 80. By default the maximum
  amount of pods is set to 1000.</li>
<li>no_csa.sh - this script turns off the cluster-autoscaling by constraining the amount of pods to the capacity of the controller.</li>
<li>unassing_node.sh - this script unassigned the node from the node pool, the node will be turned off. You need to pass the id of the node as an arugment.</li>
<li>downscale.sh - this script will delete horizontal pod autoscaling and downscale pods to 1</li>
</ul>
<h3 id="test-running">Test running</h3>
<p>Before you run the test make sure that cluster-probe is running by checking:</p>
<p><code>kubectl get pods</code></p>
<p><img alt="img.png" src="../../img/cluster-pod.png" /></p>
<p>if the result is different you should create a deployment:</p>
<p><code>kubectl apply -f clusterProbe_test.yaml</code></p>
<p>Now if you want to configure your cluster or track the pods count you can run one of the <a href="./#scripts">scripts</a></p>
<p>In order to run tests from the ProbeBuilder you need to configure port forwarding with ssh. Open another window in your terminal and run:</p>
<p><code>ssh -L 9090:localhost:9090 user@10.196.37.164</code></p>
<p>and now another forward to reCluster:</p>
<p><code>ssh -L 9090:10.43.252.50:8080 root@recluster</code></p>
<p>Now you can run test from your machine on localhost:9090.</p>
<p>If you additionally what to be able to monitor your tests you should create similar forwarding on port 3030:</p>
<p>relaptop:
<code>ssh -L 3030:localhost:3030 user@10.196.37.164</code></p>
<p>recluster:
<code>ssh -L 3030:localhost:8080 recluster</code></p>
<p>Now you should be able to see the table of nodes in the scaling page of ProbeBuilder:</p>
<p><img alt="img.png" src="../../img/monitor.png" /></p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
